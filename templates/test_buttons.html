<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Boutons Zoom et Plein Écran</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Test des Boutons de Zoom et Plein Écran</h1>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Bouton Plein Écran</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-outline-primary btn-sm" onclick="openMapFullscreen()" title="Ouvrir la carte en plein écran">
                            <i class="bi bi-fullscreen"></i> Plein écran
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Boutons Zoom</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-outline-success btn-sm me-2" 
                                onclick="zoomToLocation(48.8566, 2.3522, 'Tour Eiffel', 'Monument')">
                            <i class="bi bi-zoom-in"></i> Zoom Paris
                        </button>
                        
                        <button class="btn btn-outline-info btn-sm me-2" 
                                onclick="zoomToLocation(45.764, 4.8357, 'Lyon', 'Ville')">
                            <i class="bi bi-zoom-in"></i> Zoom Lyon
                        </button>
                        
                        <button class="btn btn-outline-warning btn-sm" 
                                onclick="zoomToLocation('invalid', 'coords', 'Test invalide', 'Erreur')">
                            <i class="bi bi-zoom-in"></i> Test Erreur
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Test de Debug</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-secondary" onclick="testFunctions()">
                            <i class="bi bi-bug"></i> Tester les Fonctions
                        </button>
                        
                        <button class="btn btn-info" onclick="console.log('Test console')">
                            <i class="bi bi-terminal"></i> Test Console
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="alert alert-info">
                    <h6>Instructions:</h6>
                    <ul class="mb-0">
                        <li>Ouvrez les outils de développement (F12) pour voir les logs</li>
                        <li>Le bouton "Plein écran" devrait ouvrir l'interface principale</li>
                        <li>Les boutons "Zoom" devraient ouvrir l'interface avec les coordonnées spécifiées</li>
                        <li>Le "Test Erreur" devrait afficher un message d'erreur</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Fonction pour ouvrir la carte en plein écran
        function openMapFullscreen() {
            console.log('Tentative d\'ouverture de la carte en plein écran');
            
            // D'abord essayer de trouver l'iframe de la carte
            const iframe = document.querySelector('iframe.map-frame');
            if (iframe && iframe.src) {
                console.log('Iframe trouvée, ouverture de:', iframe.src);
                window.open(iframe.src, '_blank', 'width=1200,height=800');
            } else {
                // Fallback: ouvrir l'interface principale
                console.log('Iframe non trouvée, ouverture de l\'interface principale');
                window.open('/app', '_blank', 'width=1200,height=800');
            }
        }
        
        // Fonction pour zoomer sur une location spécifique
        function zoomToLocation(lat, lng, name, type) {
            console.log('Zoom vers:', { lat, lng, name, type });
            
            // Validation des paramètres
            if (!lat || !lng || isNaN(lat) || isNaN(lng)) {
                console.error('Coordonnées invalides:', { lat, lng, name, type });
                alert('Coordonnées invalides pour ce zoom');
                return;
            }
            
            // Ouvrir l'interface principale avec les coordonnées
            const appUrl = `/app?lat=${lat}&lon=${lng}&address=${encodeURIComponent(name || 'Point d\'intérêt')}`;
            console.log('Ouverture interface principale:', appUrl);
            
            // Ouvrir dans un nouvel onglet
            window.open(appUrl, '_blank', 'width=1200,height=800');
            
            // Feedback visuel
            showZoomFeedback(name || 'Élément', type || 'Point');
        }
        
        // Feedback visuel pour confirmer le zoom
        function showZoomFeedback(name, type) {
            // Créer une notification temporaire
            const notification = document.createElement('div');
            notification.className = 'alert alert-success position-fixed';
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="bi bi-zoom-in"></i> 
                Zoom sur: <strong>${name}</strong> 
                <small>(${type})</small>
            `;
            
            document.body.appendChild(notification);
            
            // Supprimer après 3 secondes
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
        
        // Test function pour debug
        function testFunctions() {
            console.log('Test des fonctions:');
            console.log('- openMapFullscreen:', typeof openMapFullscreen);
            console.log('- zoomToLocation:', typeof zoomToLocation);
            
            // Test d'ouverture
            openMapFullscreen();
        }
        
        console.log('Page de test chargée avec succès');
    </script>
</body>
</html>
